<!DOCTYPE html>
<html>
<head>
	<title></title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, user-scalable=no">
	<!-- Estilos externos //google -->
    <link href='https://fonts.googleapis.com/css?family=Open+Sans|Oswald' rel='stylesheet' type='text/css'>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- Estilos locales -->
		<link rel="stylesheet" type="text/css" href="../../lib/Rhino/css/Rhino.css">
    <link rel="stylesheet" type="text/css" href="css/nucleo.css">
</head>
<body>
	<div contenedor></div>
</body>
<!-- scripts que construyen la interfaz y su funcionamiento -->
<script type="text/javascript" src='../../lib/Rhino/motorRegistros.js'></script>
<script type="text/javascript" src='../../lib/Rhino/Rhino.js'></script>
<!-- scripts PLUGINS-->
<script type="text/javascript" src='../../lib/Rhino/plugins/O_Maestro.js'></script>
<script type="text/javascript" src='../../lib/Rhino/plugins/O_CampoBusqueda.js'></script>
<script type="text/javascript" src='../../lib/Rhino/plugins/O_CampoIdentificacion.js'></script>
<!-- script con el constructor del formulario-->
<script type="text/javascript" src='js/constructores/nucleo.js'></script>
<!-- script extra-->
<script type="text/javascript" src='js/nucleo.js'></script>

<script type="text/javascript">
/*-----------------------------Inicialiazacion de formulario--------------------------------------------------*/
	//arranca la sesion
	var sesion = new Sesion();

	//arranca el motor de registros que se comunica con BD
	var torque = new Motor('agronomia','nucleo');

	//Inicialiazion de UI(Interfaz De Usuario)
	var UI = new Arquitecto();
	UI.agregarConstructor(nucleo);
	UI.configure({
		maestro:{
			entidad: torque.entidadActiva,
			botones: [{
				tipo:'nuevo',
				click:function(){validarRif();}
			},{
				tipo:'modificar',
				click:function(){modificar();}
			}]
		},
		botonera:{
			botones:['nuevo','abrir']
		}
	});

	sesion.obtenerSesion();
/*-------------------------Fin Inicialiazacion de formulario--------------------------------------------------*/
UI.elementos.botonera.buscarBoton('nuevo').nodo.onclick = function(){
	validarRif();
};

validarRif =function (){
	UI.elementos.maestro.quitarformulario();
	var modal = UI.crearVentanaModal({
	  contenido: 'ancho',
	  cabecera:{
	    html: 'Verificacion de Rif',
			clases:['verificacion']
	  },
	  cuerpo:{
	    tipo:'nuevo',
	    formulario: {
				campos:[UI.buscarConstructor('nucleo').campos[0]]
			},
	  },
	  pie:{
	      html:'<button type="button" class="mat-text-but">Verificar</button>',
				clases:['operaciones']
	  }
	});

	modal.nodo.querySelector('button.mat-text-but').onclick = function(){
		var rif =  modal.partes.cuerpo.formulario.buscarCampo('rif').captarValor();
		if(rif){
			var peticion = {
			   modulo: "global",
			   entidad: "organizacion",
			   operacion: "buscarRegistro",
			   codigo: rif
			};
			var cuadro = {
				contenedor: modal.partes.cuerpo.nodo,
				cuadro:{
				  nombre: 'verificacionRif',
				  mensaje: 'Verificando Rif en la Base de Datos'
				}
			};
			torque.manejarOperacion(peticion,cuadro).then(function(respuesta){
				UI.elementos.maestro.agregarFormulario({tipo:'nuevo'});
				formulario = UI.elementos.maestro.forma.formulario;
				if(respuesta.success){
					formulario.asignarValores(respuesta.registros);
					formulario.buscarCampo('rif').deshabilitar();
					formulario.buscarCampo('nombre_completo').deshabilitar();
					formulario.buscarCampo('codigo_tipo_persona').deshabilitar();
				}else{
					formulario.buscarCampo('rif').asignarValor(rif);
					formulario.buscarCampo('rif').deshabilitar();
				}
				UI.elementos.modalWindow.eliminarUltimaCapa();
			});
		}else{
			  UI.agregarToasts({
			    texto: 'Rellene el campo para poder verificar',
			    tipo: 'web-arriba-derecha-alto'
			  });
		}
	};
}
modificar = function(){
	var maestro = UI.elementos.maestro;
	maestro.modificar();
	maestro.forma.formulario.deshabilitar();
	maestro.forma.formulario.buscarCampo('codigo').habilitar();
}

</script>
</html>
